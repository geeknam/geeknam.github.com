<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: web service | geeknam's blog]]></title>
  <link href="http://geeknam.github.com/categories/web-service/atom.xml" rel="self"/>
  <link href="http://geeknam.github.com/"/>
  <updated>2012-02-13T13:55:15+11:00</updated>
  <id>http://geeknam.github.com/</id>
  <author>
    <name><![CDATA[Ngo Minh Nam]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Simple web service with Google App Engine]]></title>
    <link href="http://geeknam.github.com/2010/06/13/simple-web-service-with-google-app-engine/"/>
    <updated>2010-06-13T13:44:00+10:00</updated>
    <id>http://geeknam.github.com/2010/06/13/simple-web-service-with-google-app-engine</id>
    <content type="html"><![CDATA[<p>It's been a while since I last posted an entry. Nothing much has changed in my life. The two-week holiday has just passed by in a blink of an eye. Has been busy with Android assignment, Cypher IGs camp and Pycon Singapore 2010. Now after Pycon, I'm pretty much convinced about the power of simplicity of Python. Knowing Google App Engine (GAE) quite a while ago, I decided to use GAE to help me out in my assignment (yes, yes, Google to the rescue) by writing a simple GAE web service which stores/retrieves feedbacks in form of JSON. The following tutorial is simple enough for beginners to follow.</p>

<!-- more -->


<p>``` python
import urllib
import json
from google.appengine.api import mail
from google.appengine.ext import webapp, db
from google.appengine.ext.webapp import util
from google.appengine.ext.webapp.util import run_wsgi_app</p>

<p>class Feedback(db.Model):</p>

<pre><code>user     = db.StringProperty()
heritage = db.StringProperty()
comment  = db.StringProperty(multiline=True)
star     = db.IntegerProperty()
date     = db.DateTimeProperty(auto_now_add=True)

#Convert feedback object into a dictionary
def toDict(self):
    return {'user': self.user,'heritage': self.heritage,
                'comment': self.comment,'star':  self.star,'date': self.date}
</code></pre>

<p>class FeedbackGetter(webapp.RequestHandler):</p>

<pre><code>def get(self,heritage):
#Retrieve feedbacks of a particular heritage requested
    heritage = urllib.unquote(heritage)
    feedbacks = db.GqlQuery("SELECT * FROM Feedback WHERE heritage = :1", heritage)

    feedDict = {}
    for feedback in feedbacks:
        feedDict[str(feedback.key())] = feedback.toDict()

    self.response.out.write(json.encode(feedDict));
</code></pre>

<p>class FeedbackStore(webapp.RequestHandler):</p>

<pre><code>def post(self):
#Storing feedback in datastore
    feedback = Feedback()
    feedback.user     = self.request.get('email')
    feedback.heritage = self.request.get('heritage')
    feedback.comment  = self.request.get('comment')
    feedback.star     = int(self.request.get('star'))
    feedback.put()

    #Sending confirmation email to the user
    myemail         = mail.EmailMessage()
    myemail.sender  = "World Heritage Site &lt;noreply@androidnam.appspotmail.com&gt;"
    myemail.to      = feedback.user
    myemail.subject = "Feedback on " + feedback.heritage
    myemail.body    = '''
    Thank you for submitting your feedback, \n
    Heritage: %s \n
    Comment: %s \n
    Rating: %s 
    ''' % (feedback.heritage, feedback.comment, feedback.star)
    myemail.send()

    self.redirect('/get/'+feedback.heritage)
</code></pre>

<p>class FeedbackForm(webapp.RequestHandler):</p>

<pre><code>def get(self):
    self.response.out.write("""
    &lt;html&gt;
      &lt;body&gt;
        &lt;form action="/store" method="post"&gt;
          Heritage:&lt;div&gt;&lt;input name="heritage" /&gt;&lt;/div&gt;
          Email:&lt;div&gt;&lt;input name="email" /&gt;&lt;/div&gt;
          Comment:&lt;div&gt;&lt;input name="comment" /&gt;&lt;/div&gt;
          Star:&lt;div&gt;&lt;input name="star" /&gt;&lt;/div&gt;
          &lt;div&gt;&lt;input type="submit" value="Submit"&gt;&lt;/div&gt;
        &lt;/form&gt;
      &lt;/body&gt;
    &lt;/html&gt;
    """)
</code></pre>

<p>application = webapp.WSGIApplication([(r'/get/(.*)', FeedbackGetter),</p>

<pre><code>                  ('/store', FeedbackStore),
                  ('/feedback', FeedbackForm)],
                                  debug=True)
</code></pre>

<p>def main():</p>

<pre><code>run_wsgi_app(application)
</code></pre>

<p>if <strong>name</strong> == "<strong>main</strong>":</p>

<pre><code>main()
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
</feed>
